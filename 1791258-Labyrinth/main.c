#include <stdio.h>
#include <conio.h>
#include <Windows.h>
#include <mmsystem.h>
#pragma comment(lib,"winmm.lib")

#define Game_OST "C:\\Users\\pc\\Desktop\\1791258-Labyrinth\\1791258-Labyrinth\\outbreak.wav"

// 색상 정의
#define BLACK	0
#define BLUE1	1
#define GREEN1	2
#define CYAN1	3
#define RED1	4
#define MAGENTA1 5
#define YELLOW1	6
#define GRAY1	7
#define GRAY2	8
#define BLUE2	9
#define GREEN2	10
#define CYAN2	11
#define RED2	12
#define MAGENTA2 13
#define YELLOW2	14
#define WHITE	15

#define STAR '*'
#define BLANK ' '
#define DOT '.'

#define ESC 0x1b

#define SPECIAL1 0xe0 // 특수키는 0xe0 + key 값으로 구성된다.
#define SPECIAL2 0x00 // keypad 경우 0x00 + key 로 구성된다.

#define UP  0x48 // Up key는 0xe0 + 0x48 두개의 값이 들어온다.
#define DOWN 0x50
#define LEFT 0x4b
#define RIGHT 0x4d

#define UP2		'w'
#define DOWN2	's'
#define LEFT2	'a'
#define RIGHT2	'd'

#define WIDTH 80
#define HEIGHT 24

int map[HEIGHT][WIDTH] = {  //맵 구성
	{ 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,2,2,2,2,1,1,1,2,2,2,2,2,1,2,0,0,0,0,0,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,2,0,0,2,1,1,1,2,0,0,0,2,1,2,0,4,0,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,2,2,2,2,2,2,2,2,2,2,2,0,0,2,1,2,0,0,2,1,1,1,2,0,0,0,2,1,2,0,0,0,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,1,1,1,1,1,1,1,1,1,1,2,0,0,2,1,2,0,0,2,2,2,2,2,0,0,0,2,1,2,2,2,2,2,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,2,2,2,2,2,2,2,2,1,1,2,0,0,2,1,2,0,0,0,0,3,0,0,0,0,0,2,1,1,1,1,1,2,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,2,0,0,0,0,0,0,2,1,1,2,0,0,2,1,2,0,0,0,0,3,0,0,0,0,0,2,1,1,1,1,1,2,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,2,0,0,0,0,0,0,2,1,1,2,0,0,2,1,2,0,0,2,2,2,2,2,0,0,0,2,1,1,1,2,2,2,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,2,0,0,0,0,0,0,2,2,2,2,0,0,2,1,2,0,0,2,1,1,1,2,2,2,2,2,1,1,1,2,0,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,2,0,0,0,0,0,0,0,0,3,0,0,0,2,1,2,0,0,2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,2,0,0,0,0,0,0,0,0,3,0,0,0,2,1,2,0,0,2,1,2,2,2,2,2,2,2,2,2,1,2,0,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,2,0,0,0,0,0,0,2,2,2,2,0,0,2,1,2,0,0,2,1,2,0,0,0,0,0,0,0,2,1,2,2,2,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,2,2,2,2,2,2,2,2,1,1,2,0,0,2,1,2,0,0,2,1,2,0,0,0,0,0,0,0,2,1,1,1,2,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,1,1,1,1,1,1,1,1,1,1,2,0,0,2,1,2,0,0,2,1,2,0,0,0,0,0,0,0,2,1,1,1,2,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,2,2,2,2,2,2,2,2,2,1,2,0,0,2,1,2,0,0,2,1,2,0,0,0,0,0,0,0,2,1,1,1,2,0,0,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,2,0,0,0,0,0,0,0,2,1,2,0,0,2,1,2,0,0,2,1,2,2,2,0,0,2,2,2,2,1,1,1,2,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,2,0,0,0,0,0,0,0,2,2,2,0,0,2,1,2,0,0,2,1,1,1,2,3,3,2,1,1,1,1,1,1,2,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,2,0,0,0,0,0,0,0,0,3,0,0,0,2,1,2,0,0,2,1,1,1,2,0,0,2,1,1,1,1,1,1,2,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,2,0,0,0,0,0,0,0,0,3,0,0,0,2,2,2,0,0,2,2,2,2,2,0,0,2,2,2,2,2,2,2,2,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,2,0,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,2,2,2,2,2,2,2,2,2,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
{ 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 }
};

//SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE),14) 글자색 바꾸는 함수

void playr_dead();

void player_survive();

typedef struct Player {	//캐릭터 정보
	int x, y;		//x,y 위치
	char *player_shape;

}Player;

Player P;

int key_item = 0; //키를 먹을 때마다 +1 하고 key_item이 4 이면서 살면 탈출성공

int key_item_room1 = 0;
int key_item_room2 = 0;
int key_item_room3 = 0;
int key_item_room4 = 0;

int Player_HP = 0;	//함정 밟을시 1씩 증가, 3이 될때 사망처리

int map_state = 0;	//room과 map을 분별해주는 정수

int Delay = 50; // 100 msec delay, 이 값을 줄이면 속도가 빨라진다.

void removeCursor(void) { // 커서를 안보이게 한다

	CONSOLE_CURSOR_INFO curInfo;
	GetConsoleCursorInfo(GetStdHandle(STD_OUTPUT_HANDLE), &curInfo);
	curInfo.bVisible = 0;
	SetConsoleCursorInfo(GetStdHandle(STD_OUTPUT_HANDLE), &curInfo);
}

void gotoxy(int x, int y) //내가 원하는 위치로 커서 이동
{
	COORD pos = { x, y };
	SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE), pos);// WIN32API 함수입니다. 이건 알필요 없어요
}

void put_character(int x, int y, char ch[])
{
	gotoxy(x, y);
	puts(ch);
}

void erase_character(int x, int y)
{
	gotoxy(x, y);
	putchar(BLANK);//(BLANK);
}

void textcolor(int fg_color)
{
	SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), fg_color);
}

// 화면 지우기고 원하는 배경색으로 설정한다.

void cls(int bg_color, int text_color)
{
	char cmd[100];
	system("cls");
	sprintf(cmd, "COLOR %x%x", bg_color, text_color);
	system(cmd);

}
// box 그리기 함수, ch 문자열로 (x1,y1) ~ (x2,y2) box를 그린다.

void draw_box2(int x1, int y1, int x2, int y2)
{
	int x, y;
	//int len = strlen(ch);
	for (x = x1; x <= x2; x += 2) { // 한글은 2칸씩 차지한다.
		gotoxy(x, y1);
		printf("%s", "□"); // ㅂ 누르고 한자키 누르고 선택
		gotoxy(x, y2);
		printf("%s", "□");
	}
	for (y = y1; y <= y2; y++) {
		gotoxy(x1, y);
		printf("%s", "□");
		gotoxy(x2, y);
		printf("%s", "□");
	}
	gotoxy(x1, y1); printf("□");
	gotoxy(x1, y2); printf("□");
	gotoxy(x2, y1); printf("□");
	gotoxy(x2, y2); printf("□");
}

void room1(Player *p2, Player *p1) {
	p2->x = 4; p2->y = 22;
	system("cls");
	int i, j;
	int room[HEIGHT][WIDTH] = {  //맵 구성
		{ 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,3,0,0,3,0,0,0,0,0,0,2,1,2,2,2,2,2,2,2,2,1,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,0,0,0,0,0,0,0,0,0,2,1,2,0,0,6,0,0,0,2,1,2,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,5,5,2,2,2,2,2,2,0,0,2,1,2,2,2,0,0,2,2,2,1,2,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,5,5,2,1,1,1,1,2,0,0,2,1,1,1,2,0,0,2,1,1,2,2,0,0,2,1,2,2,2,2,2,2,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,2,2,2,1,1,1,1,2,0,0,2,1,1,1,2,0,0,2,1,1,2,0,0,0,2,1,2,0,0,0,0,2,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,1,1,1,1,1,1,1,1,2,0,0,2,1,1,1,2,0,3,2,1,1,2,0,0,2,2,1,2,0,0,0,0,2,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,1,1,1,1,1,1,1,1,2,0,0,2,1,1,1,2,0,0,2,1,1,2,0,0,2,2,2,2,3,3,3,3,2,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,1,2,2,2,2,1,1,1,2,0,0,2,2,2,1,2,0,0,2,1,1,2,0,0,0,0,0,0,0,4,4,3,2,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,1,2,0,0,2,1,2,2,2,0,0,0,0,2,2,0,3,0,2,2,2,2,0,0,3,0,0,0,0,4,4,3,2,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,1,2,3,0,2,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,3,2,2,2,2,3,3,3,3,2,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,1,2,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,2,0,0,0,0,2,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,1,2,0,3,0,0,2,2,2,0,3,0,2,2,2,2,0,3,2,2,2,2,5,0,2,1,1,2,0,0,0,0,2,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,1,2,0,0,0,3,2,1,2,0,0,2,1,1,1,2,0,0,2,1,1,2,0,0,2,1,1,2,2,2,2,2,2,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,1,2,2,2,2,2,2,1,2,0,0,2,1,1,1,2,0,0,2,1,1,2,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,1,1,1,1,1,1,1,1,2,0,0,2,1,1,1,2,0,0,2,1,1,2,2,2,2,1,1,1,1,1,1,2,2,2,2,2,2,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,2,2,2,2,2,2,2,2,3,0,2,1,1,1,2,3,0,2,1,2,2,2,2,2,2,2,1,1,1,1,2,0,0,0,0,2,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,0,0,0,0,0,0,0,0,0,2,1,1,1,2,0,0,2,1,2,5,5,5,5,5,2,1,1,1,1,2,0,2,0,0,2,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,0,0,0,0,0,0,3,0,0,2,1,1,1,2,0,3,2,1,2,2,2,2,0,3,2,1,1,1,1,2,0,2,0,0,2,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,0,2,2,2,2,2,2,0,0,2,2,2,2,2,0,0,2,1,1,1,1,2,0,0,2,2,2,2,2,2,2,2,0,0,2,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,0,2,1,1,1,1,2,0,0,0,0,0,0,3,0,0,2,2,2,2,2,2,0,0,0,0,0,0,0,0,0,0,0,0,2,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,0,2,1,1,1,1,2,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,0,2,1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,2,2,2,2,2,2,2,2,2,2,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 }
	};		//맵 그리기 위한 배열

	if (key_item_room1 == 1) {
		for (i = 0; i < 80; i++) {
			for (j = 0; j < 24; j++) {
				if (room[j][i] == 6)
				{
					room[j][i] = 0;
				}
			}
		}
	}

	for (i = 0; i < 24; i++)
	{
		for (j = 0; j < 39; j++)
		{
			if (room[i][j] == 1)
			{
				textcolor(7);	//회색벽
				printf("□");			//벽 테두리
			}
			else if (room[i][j] == 2)	//미궁 벽
			{
				textcolor(15);	//흰색벽
				printf("■");
			}

			else if (room[i][j] == 3) {
				textcolor(4);	//함정 - 빨간색
				printf("▲");
			}

			else if (room[i][j] == 4)
			{
				textcolor(6);	//출구 - 노란색
				printf("▥");
			}

			else if (room[i][j] == 5)
			{
				textcolor(8);	//무너진 벽 회색2
				printf("▒");
			}

			else if (room[i][j] == 6)
			{
				textcolor(14);	//열쇠 - 노랑2
				printf("§");
			}

			else
			{
				printf("  ");			//복도, 뚫린길
			}
		}
		printf("\n");
	}		//맵그리는 반복문



	while (map_state != 1) {

		while (map_state != 1) {		//캐릭터 움직이는 함수

			unsigned char ch; // 특수키 0xe0 을 입력받으려면 unsigned char 로 선언해야 함
			int oldx, oldy, newx, newy;
			int keep_moving;

			int i, j;



			newx = oldx = p2->x;
			newy = oldy = p2->y;

			removeCursor();
			textcolor(15);//캐릭터는 흰색
			put_character(oldx, oldy, p2->player_shape);
			ch = 0; // 초기값 정지상태
			keep_moving = 0;

			while (map_state != 1) {
				if (kbhit() == 1) {
					ch = getch();
					if (ch == ESC)
						break;
					if (ch == SPECIAL1 || ch == SPECIAL2) { // 만약 특수키
															// 예를 들어 UP key의 경우 0xe0 0x48 두개의 문자가 들어온다.
						ch = getch();
						switch (ch) {
						case UP:

						case DOWN:
						case LEFT:
						case RIGHT:
							keep_moving = 1;
							break;
						default: // 방향키가 아니면 멈춘다
							keep_moving = 0;
						}
					}
					else {
						switch (ch) {
						case UP2:
						case DOWN2:
						case LEFT2:
						case RIGHT2:
							keep_moving = 1;
							break;
						default: // 방향키가 아니면 멈춘다
							keep_moving = 0;
						}
						// 특수 문자가 아니지만 AWSD를 방향키 대신 사용하는 경우 처리
					}
				}
				if (keep_moving == 1) { // 움직이고 있으면
										//
										// 벽을 만나면 방향을 변경하기 추가
										// 벽을 만날때 Delay 를 감소시키면 속도가 빨라진다.
										//			
					switch (ch) {
					case UP:
					case UP2:
						if (oldy > 0) { //벽이 아니면
										//newy = oldy - 1;

							newy = oldy - 1;
						}
						else {
							newy = oldy + 1;
							ch = DOWN;
							/*if (Delay > 10)
							Delay -= 10;*/
						}
						break;
					case DOWN:
					case DOWN2:
						if (oldy < HEIGHT - 1) {
							newy = oldy + 1;
						}
						else {
							newy = oldy - 1;
							ch = UP;
							/*if (Delay > 10)
							Delay -= 10;*/
						}
						break;
					case LEFT:
					case LEFT2:
						if (oldx > 0) {
							newx = oldx - 1;
							/*Delay += 2;*/
						}
						else {
							/*newx = oldx + 1;
							ch = RIGHT;*/
							/*if (Delay > 10)
							Delay -= 10;*/
							newx = WIDTH - 1; // 터널 효과
						}
						break;
					case RIGHT:
					case RIGHT2:
						if (oldx < WIDTH - 1) {
							newx = oldx + 1;
							/*if (Delay > 5)
							Delay -= 2;*/
						}
						else {
							/*newx = oldx - 1;
							ch = LEFT;*/
							/*if (Delay > 10)
							Delay -= 10;*/
							newx = 0; //터널효과
						}
						break;
					}

					if (room[newy][newx / 2] == 1 || room[newy][newx / 2] == 2 || room[newy][newx / 2] == 5)
					{
						newy = oldy;
						newx = oldx;
					}

					erase_character(oldx, oldy); // 마지막 위치의 * 를 지우고
					put_character(newx, newy, p2->player_shape); // 새로운 위치에서 * 를 표시한다.
					oldx = newx; // 마지막 위치를 기억한다.
					p2->x = oldx;
					oldy = newy;
					p2->y = oldy;
					keep_moving = 0; //1:계속이동, 0:한번에 한칸씩이동
					gotoxy(0, 24);
					printf("%d %d\r", newx, newy);
					gotoxy(7, 24);
					printf("열쇠 조각 : %d", key_item);

					gotoxy(22, 24);
					printf("체력 : %d", Player_HP / 2);

					gotoxy(32, 24);
					printf("이 방에서 찾은 열쇠 개수 : %d", key_item_room1);

					if ((room[newy][newx / 2] == 4))
					{
						map_state = 1;
						p1->x = 18; p1->y = 10;
						system("cls");
					}

					if ((room[newy][newx / 2] == 6))	//열쇠
					{
						key_item++;

						key_item_room1++;

						room[newy][newx / 2] = 0;
						room[newy][newx / 2 + 1] = 0;
					}



					if ((room[newy][newx / 2] == 3))	//함정 밟을시
					{
						Player_HP++;
						room[newy][newx / 2] = 0;
						room[newy][newx / 2 + 1] = 0;
						room[newy][newx / 2 - 1] = 0;
					}

					if (Player_HP == 6)		//사망
					{
						system("cls");
						playr_dead();
						break;
					}
				}
			}
		}
	}
}

void room2(Player *p2, Player *p1) {
	p2->x = 26; p2->y = 22;
	system("cls");
	int i, j;
	int room[HEIGHT][WIDTH] = {  //맵 구성
		{ 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,2,2,2,1,1,1,1,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,7,1,1,7,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,5,5,2,1,1,1,1,2,4,4,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,7,1,1,7,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,5,5,2,1,1,1,1,2,4,4,2,1,2,0,0,0,0,3,3,0,0,0,0,3,2,1,1,1,7,1,1,7,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,5,0,2,2,2,2,2,2,0,0,2,1,2,3,0,0,0,0,0,0,0,3,0,0,2,1,1,1,7,1,1,7,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,5,0,0,0,0,0,0,0,0,0,2,1,2,0,0,2,2,2,2,2,2,3,0,0,2,1,1,1,7,7,1,7,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,5,0,0,0,0,0,0,2,2,2,2,1,2,0,0,2,1,1,1,1,2,0,0,0,2,1,1,1,7,7,1,7,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,2,2,2,2,2,0,0,2,1,1,1,1,2,0,0,2,1,1,1,1,2,3,0,3,2,1,1,1,7,7,7,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,1,1,1,1,1,2,0,0,2,2,2,2,2,2,0,0,2,1,1,1,1,2,0,0,0,2,7,1,1,7,7,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,2,2,1,1,2,0,0,0,0,0,0,0,3,3,0,2,2,2,2,2,2,0,3,0,2,7,1,1,7,7,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,2,1,1,2,0,0,0,0,0,0,0,3,3,0,0,0,5,5,2,2,0,0,6,2,7,7,1,7,7,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,2,1,1,2,0,0,2,2,2,2,2,3,3,0,0,0,0,0,2,2,2,2,2,2,7,7,1,7,7,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,2,1,1,2,0,0,2,1,1,1,2,0,0,2,2,2,0,0,2,1,1,1,1,1,1,7,1,7,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,2,1,1,2,0,0,2,1,1,1,2,0,0,2,1,2,0,0,2,1,1,1,1,1,1,7,7,7,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,2,2,2,2,0,0,2,2,2,2,2,0,0,2,2,2,0,0,2,2,2,2,2,2,2,2,2,7,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,2,7,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,7,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,2,2,2,3,3,2,2,2,2,0,0,3,3,0,2,2,2,2,2,2,2,2,7,7,7,7,2,7,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,2,1,2,3,3,2,1,1,2,0,0,0,0,0,2,1,1,1,1,1,1,2,7,7,7,7,2,7,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,2,1,2,3,3,2,2,2,2,3,3,0,0,0,2,1,1,1,1,1,1,2,7,7,7,7,2,7,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,2,1,2,3,3,3,3,2,2,0,0,0,3,3,2,1,1,1,1,1,1,2,7,7,7,7,7,7,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,2,1,2,3,3,3,3,2,2,0,0,0,0,0,2,1,1,1,1,1,1,2,7,7,7,7,7,7,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,2,2,1,2,2,2,2,2,2,2,0,0,0,0,0,2,1,1,1,1,1,1,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 }
	};		//맵 그리기 위한 배열

	if (key_item_room2 == 1) {
		for (i = 0; i < 80; i++) {
			for (j = 0; j < 24; j++) {
				if (room[j][i] == 6)
				{
					room[j][i] = 0;
				}
			}
		}
	}

	for (i = 0; i < 24; i++)
	{
		for (j = 0; j < 39; j++)
		{
			if (room[i][j] == 1)
			{
				textcolor(7);	//회색벽
				printf("□");			//벽 테두리
			}
			else if (room[i][j] == 2)	//미궁 벽
			{
				textcolor(2);	//초록 벽 
				printf("■");
			}

			else if (room[i][j] == 3) {
				textcolor(4);	//함정 - 빨간색
				printf("▲");
			}

			else if (room[i][j] == 4)
			{
				textcolor(6);	//출구 - 노란색
				printf("▥");
			}

			else if (room[i][j] == 5)
			{
				textcolor(8);	//무너진 벽 회색2
				printf("▒");
			}

			else if (room[i][j] == 6)
			{
				textcolor(14);	//열쇠 - 노랑2
				printf("§");
			}

			else if (room[i][j] == 7)
			{
				textcolor(1);	//물 - 노랑2
				printf("◐");
			}

			else
			{
				printf("  ");			//복도, 뚫린길
			}
		}
		printf("\n");
	}		//맵그리는 반복문

	while (map_state != 1) {

		while (map_state != 1) {		//캐릭터 움직이는 함수

			unsigned char ch; // 특수키 0xe0 을 입력받으려면 unsigned char 로 선언해야 함
			int oldx, oldy, newx, newy;
			int keep_moving;

			int i, j;



			newx = oldx = p2->x;
			newy = oldy = p2->y;

			removeCursor();
			textcolor(15);//캐릭터는 흰색
			put_character(oldx, oldy, p2->player_shape);
			ch = 0; // 초기값 정지상태
			keep_moving = 0;

			while (map_state != 1) {
				if (kbhit() == 1) {
					ch = getch();
					if (ch == ESC)
						break;
					if (ch == SPECIAL1 || ch == SPECIAL2) { // 만약 특수키
															// 예를 들어 UP key의 경우 0xe0 0x48 두개의 문자가 들어온다.
						ch = getch();
						switch (ch) {
						case UP:

						case DOWN:
						case LEFT:
						case RIGHT:
							keep_moving = 1;
							break;
						default: // 방향키가 아니면 멈춘다
							keep_moving = 0;
						}
					}
					else {
						switch (ch) {
						case UP2:
						case DOWN2:
						case LEFT2:
						case RIGHT2:
							keep_moving = 1;
							break;
						default: // 방향키가 아니면 멈춘다
							keep_moving = 0;
						}
						// 특수 문자가 아니지만 AWSD를 방향키 대신 사용하는 경우 처리
					}
				}
				if (keep_moving == 1) { // 움직이고 있으면
										//
										// 벽을 만나면 방향을 변경하기 추가
										// 벽을 만날때 Delay 를 감소시키면 속도가 빨라진다.
										//			
					switch (ch) {
					case UP:
					case UP2:
						if (oldy > 0) { //벽이 아니면
										//newy = oldy - 1;

							newy = oldy - 1;
						}
						else {
							newy = oldy + 1;
							ch = DOWN;
							/*if (Delay > 10)
							Delay -= 10;*/
						}
						break;
					case DOWN:
					case DOWN2:
						if (oldy < HEIGHT - 1) {
							newy = oldy + 1;
						}
						else {
							newy = oldy - 1;
							ch = UP;
							/*if (Delay > 10)
							Delay -= 10;*/
						}
						break;
					case LEFT:
					case LEFT2:
						if (oldx > 0) {
							newx = oldx - 1;
							/*Delay += 2;*/
						}
						else {
							/*newx = oldx + 1;
							ch = RIGHT;*/
							/*if (Delay > 10)
							Delay -= 10;*/
							newx = WIDTH - 1; // 터널 효과
						}
						break;
					case RIGHT:
					case RIGHT2:
						if (oldx < WIDTH - 1) {
							newx = oldx + 1;
							/*if (Delay > 5)
							Delay -= 2;*/
						}
						else {
							/*newx = oldx - 1;
							ch = LEFT;*/
							/*if (Delay > 10)
							Delay -= 10;*/
							newx = 0; //터널효과
						}
						break;
					}

					if (room[newy][newx / 2] == 1 || room[newy][newx / 2] == 2 || room[newy][newx / 2] == 5 || room[newy][newx / 2] == 7)
					{
						newy = oldy;
						newx = oldx;
					}

					erase_character(oldx, oldy); // 마지막 위치의 * 를 지우고
					put_character(newx, newy, p2->player_shape); // 새로운 위치에서 * 를 표시한다.
					oldx = newx; // 마지막 위치를 기억한다.
					p2->x = oldx;
					oldy = newy;
					p2->y = oldy;
					keep_moving = 0; //1:계속이동, 0:한번에 한칸씩이동
					gotoxy(0, 24);
					printf("%d %d\r", newx, newy);
					gotoxy(7, 24);
					printf("열쇠 조각 : %d", key_item);

					gotoxy(22, 24);
					printf("체력 : %d", Player_HP / 2);

					gotoxy(32, 24);
					printf("이 방에서 찾은 열쇠 개수 : %d", key_item_room2);

					if ((room[newy][newx / 2] == 4))
					{
						map_state = 1;
						p1->x = 20; p1->y = 18;
						system("cls");
					}

					if ((room[newy][newx / 2] == 6))	//열쇠
					{
						key_item++;
						key_item_room2++;
						room[newy][newx / 2] = 0;
						room[newy][newx / 2 + 1] = 0;
					}

					if ((room[newy][newx / 2] == 3))	//함정 밟을시
					{
						Player_HP++;
						room[newy][newx / 2] = 0;
						room[newy][newx / 2 + 1] = 0;
						room[newy][newx / 2 - 1] = 0;
					}

					if (Player_HP == 6)		//사망
					{
						system("cls");
						playr_dead();
						break;
					}
				}
			}
		}
	}
}

void room3(Player *p2, Player *p1) {
	p2->x = 5; p2->y = 3;
	system("cls");
	int i, j;
	int room[HEIGHT][WIDTH] = {  //맵 구성
		{ 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,2,1,1,1,1,1,1,1,1,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,0,0,0,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,2,1,1,1,1,1,1,1,1,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,5,5,0,0,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,1,1,2,2,2,2,1,1,1,1,1,1,1,2,5,5,3,0,2,1,1,1,1,1,2,2,2,2,2,2,2,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,1,1,2,2,2,2,1,1,1,1,1,1,1,2,0,0,0,0,2,1,1,1,1,1,2,5,7,7,7,7,2,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,1,1,1,2,2,2,2,2,2,2,2,2,2,2,0,0,3,3,2,2,2,2,2,2,2,5,0,7,7,7,2,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,2,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,1,1,1,2,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0,2,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,1,1,1,2,0,0,2,1,1,1,1,2,4,4,2,1,1,1,1,1,1,1,1,1,1,1,1,2,0,0,2,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,1,1,1,2,0,0,2,1,1,1,1,2,4,4,2,1,1,1,1,1,1,1,1,1,1,1,1,2,0,0,2,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,1,1,1,2,0,0,2,1,1,1,1,2,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,2,0,0,2,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,1,1,1,2,0,0,2,2,2,2,2,2,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,2,0,0,2,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,1,1,1,2,0,0,0,0,0,0,0,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,2,0,0,2,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,1,1,1,2,0,0,0,0,0,0,0,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,2,0,0,2,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,1,1,1,2,0,0,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,2,0,0,2,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,1,1,1,2,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,0,0,2,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,1,1,1,2,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,0,2,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,6,0,0,0,0,0,0,2,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,1,1,1,2,0,0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,0,0,0,0,0,0,0,2,1,1,1,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,7,7,7,7,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 }
	};		//맵 그리기 위한 배열

	if (key_item_room3 == 1) {
		for (i = 0; i < 80; i++) {
			for (j = 0; j < 24; j++) {
				if (room[j][i] == 6)
				{
					room[j][i] = 0;
				}
			}
		}
	}

	for (i = 0; i < 24; i++)
	{
		for (j = 0; j < 39; j++)
		{
			if (room[i][j] == 1)
			{
				textcolor(7);	//회색벽
				printf("□");			//벽 테두리
			}
			else if (room[i][j] == 2)	//미궁 벽
			{
				textcolor(7);	//초록 벽 
				printf("■");
			}

			else if (room[i][j] == 3) {
				textcolor(4);	//함정 - 빨간색
				printf("▲");
			}

			else if (room[i][j] == 4)
			{
				textcolor(6);	//출구 - 노란색
				printf("▥");
			}

			else if (room[i][j] == 5)
			{
				textcolor(8);	//무너진 벽 회색2
				printf("▒");
			}

			else if (room[i][j] == 6)
			{
				textcolor(14);	//열쇠 - 노랑2
				printf("§");
			}

			else if (room[i][j] == 7)
			{
				textcolor(1);	//물 - 파랑
				printf("◐");
			}

			else
			{
				printf("  ");			//복도, 뚫린길
			}
		}
		printf("\n");
	}		//맵그리는 반복문

	while (map_state != 1) {

		while (map_state != 1) {		//캐릭터 움직이는 함수

			unsigned char ch; // 특수키 0xe0 을 입력받으려면 unsigned char 로 선언해야 함
			int oldx, oldy, newx, newy;
			int keep_moving;

			int i, j;



			newx = oldx = p2->x;
			newy = oldy = p2->y;

			removeCursor();
			textcolor(15);//캐릭터는 흰색
			put_character(oldx, oldy, p2->player_shape);
			ch = 0; // 초기값 정지상태
			keep_moving = 0;

			while (map_state != 1) {
				if (kbhit() == 1) {
					ch = getch();
					if (ch == ESC)
						break;
					if (ch == SPECIAL1 || ch == SPECIAL2) { // 만약 특수키
															// 예를 들어 UP key의 경우 0xe0 0x48 두개의 문자가 들어온다.
						ch = getch();
						switch (ch) {
						case UP:

						case DOWN:
						case LEFT:
						case RIGHT:
							keep_moving = 1;
							break;
						default: // 방향키가 아니면 멈춘다
							keep_moving = 0;
						}
					}
					else {
						switch (ch) {
						case UP2:
						case DOWN2:
						case LEFT2:
						case RIGHT2:
							keep_moving = 1;
							break;
						default: // 방향키가 아니면 멈춘다
							keep_moving = 0;
						}
						// 특수 문자가 아니지만 AWSD를 방향키 대신 사용하는 경우 처리
					}
				}
				if (keep_moving == 1) { // 움직이고 있으면
										//
										// 벽을 만나면 방향을 변경하기 추가
										// 벽을 만날때 Delay 를 감소시키면 속도가 빨라진다.
										//			
					switch (ch) {
					case UP:
					case UP2:
						if (oldy > 0) { //벽이 아니면
										//newy = oldy - 1;

							newy = oldy - 1;
						}
						else {
							newy = oldy + 1;
							ch = DOWN;
							/*if (Delay > 10)
							Delay -= 10;*/
						}
						break;
					case DOWN:
					case DOWN2:
						if (oldy < HEIGHT - 1) {
							newy = oldy + 1;
						}
						else {
							newy = oldy - 1;
							ch = UP;
							/*if (Delay > 10)
							Delay -= 10;*/
						}
						break;
					case LEFT:
					case LEFT2:
						if (oldx > 0) {
							newx = oldx - 1;
							/*Delay += 2;*/
						}
						else {
							/*newx = oldx + 1;
							ch = RIGHT;*/
							/*if (Delay > 10)
							Delay -= 10;*/
							newx = WIDTH - 1; // 터널 효과
						}
						break;
					case RIGHT:
					case RIGHT2:
						if (oldx < WIDTH - 1) {
							newx = oldx + 1;
							/*if (Delay > 5)
							Delay -= 2;*/
						}
						else {
							/*newx = oldx - 1;
							ch = LEFT;*/
							/*if (Delay > 10)
							Delay -= 10;*/
							newx = 0; //터널효과
						}
						break;
					}

					if (room[newy][newx / 2] == 1 || room[newy][newx / 2] == 2 || room[newy][newx / 2] == 5 || room[newy][newx / 2] == 7)
					{
						newy = oldy;
						newx = oldx;
					}

					erase_character(oldx, oldy); // 마지막 위치의 * 를 지우고
					put_character(newx, newy, p2->player_shape); // 새로운 위치에서 * 를 표시한다.
					oldx = newx; // 마지막 위치를 기억한다.
					p2->x = oldx;
					oldy = newy;
					p2->y = oldy;
					keep_moving = 0; //1:계속이동, 0:한번에 한칸씩이동
					gotoxy(0, 24);
					printf("%d %d\r", newx, newy);
					gotoxy(7, 24);
					printf("열쇠 조각 : %d", key_item);

					gotoxy(22, 24);
					printf("체력 : %d", Player_HP / 2);

					gotoxy(32, 24);
					printf("이 방에서 찾은 열쇠 개수 : %d", key_item_room3);

					if ((room[newy][newx / 2] == 4))
					{
						map_state = 1;
						p1->x = 42; p1->y = 6;
						system("cls");
					}


					if ((room[newy][newx / 2] == 6))	//열쇠
					{
						key_item++;
						key_item_room3++;
						room[newy][newx / 2] = 0;
						room[newy][newx / 2 + 1] = 0;
					}

					if ((room[newy][newx / 2] == 3))	//함정 밟을시
					{
						Player_HP++;
						room[newy][newx / 2] = 0;
						room[newy][newx / 2 + 1] = 0;
						room[newy][newx / 2 - 1] = 0;
					}

					if (Player_HP == 6)		//사망
					{
						system("cls");
						playr_dead();
						break;
					}
				}
			}
		}
	}
}

void room4(Player *p2, Player *p1) {
	p2->x = 72; p2->y = 2;
	system("cls");
	int i, j;
	int room[HEIGHT][WIDTH] = {  //맵 구성
		{ 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,2,2,2,2,2,2,5,5,5,5,5,5,5,5,5,5,5,5,5,5,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,2,2,2,7,7,7,7,7,7,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,2,2,5,7,7,5,5,7,7,7,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,2,5,5,7,7,5,5,7,7,2,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,5,5,5,7,7,7,7,7,7,2,3,0,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,0,3,0,3,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,2,2,2,7,7,7,2,2,2,2,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,3,0,3,0,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,2,2,2,7,7,2,2,0,3,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0,3,0,3,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,2,2,2,2,7,7,2,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,0,0,0,7,7,7,0,3,0,6,2,2,2,0,0,0,0,3,3,0,0,0,0,0,3,0,0,0,0,0,0,0,3,0,3,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,0,0,0,7,7,7,2,2,2,2,2,1,1,2,2,2,2,2,2,0,0,0,2,2,2,2,2,2,2,2,2,3,0,3,0,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,0,0,0,0,7,7,2,1,1,1,1,1,1,1,1,1,1,1,2,0,0,0,2,1,1,1,1,1,1,1,2,0,3,0,3,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,0,0,0,0,7,7,5,1,1,1,1,1,1,1,1,1,1,1,2,3,3,0,2,1,1,1,1,1,1,1,2,2,2,2,2,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,0,0,0,0,7,7,7,5,5,5,5,1,1,1,1,1,1,1,2,0,0,0,2,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,0,0,0,0,0,7,7,7,7,7,5,5,1,2,2,2,2,2,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,0,0,0,0,0,0,0,0,7,7,7,5,2,5,4,4,3,3,3,0,0,0,0,0,0,0,0,0,8,0,0,0,9,9,9,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,0,0,0,0,0,0,0,0,0,0,7,7,5,5,4,4,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,9,9,9,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,9,9,9,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0,0,0,0,2,9,9,9,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,0,0,0,0,0,0,2,2,9,9,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,0,0,0,2,9,9,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,7,2,2,9,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,7,9,2,2,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 },
	{ 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,7,7,7,1,1,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1 }
	};		//맵 그리기 위한 배열


	if (key_item_room4 == 1) {
		for (i = 0; i < 80; i++) {
			for (j = 0; j < 24; j++) {
				if (room[j][i] == 6)
				{
					room[j][i] = 0;
				}
			}
		}
	}

	if (key_item == 4) {
		for (i = 0; i < 80; i++) {
			for (j = 0; j < 24; j++) {
				if (room[j][i] == 8)
				{
					room[j][i] = 0;
				}
			}
		}
	}

	for (i = 0; i < 24; i++)
	{
		for (j = 0; j < 39; j++)
		{
			if (room[i][j] == 1)
			{
				textcolor(7);	//회색벽
				printf("□");			//벽 테두리
			}
			else if (room[i][j] == 2)	//미궁 벽
			{
				textcolor(7);	//초록 벽 
				printf("■");
			}

			else if (room[i][j] == 3) {
				textcolor(4);	//함정 - 빨간색
				printf("▲");
			}

			else if (room[i][j] == 4)
			{
				textcolor(6);	//출구 - 노란색
				printf("▥");
			}

			else if (room[i][j] == 5)
			{
				textcolor(8);	//무너진 벽 회색2
				printf("▒");
			}

			else if (room[i][j] == 6)
			{
				textcolor(14);	//열쇠 - 노랑2
				printf("§");
			}

			else if (room[i][j] == 7)
			{
				textcolor(1);	//물 - 파랑
				printf("◐");
			}

			else if (room[i][j] == 8) {
				textcolor(8);	//잠긴문
				printf("＠");
			}

			else if (room[i][j] == 9) {
				textcolor(15);	//진짜 출입구
				printf("▣");
			}

			else
			{
				printf("  ");			//복도, 뚫린길
			}
		}
		printf("\n");
	}		//맵그리는 반복문

	while (map_state != 1) {

		while (map_state != 1) {		//캐릭터 움직이는 함수

			unsigned char ch; // 특수키 0xe0 을 입력받으려면 unsigned char 로 선언해야 함
			int oldx, oldy, newx, newy;
			int keep_moving;

			int i, j;



			newx = oldx = p2->x;
			newy = oldy = p2->y;

			removeCursor();
			textcolor(15);//캐릭터는 흰색
			put_character(oldx, oldy, p2->player_shape);
			ch = 0; // 초기값 정지상태
			keep_moving = 0;

			while (map_state != 1) {
				if (kbhit() == 1) {
					ch = getch();
					if (ch == ESC)
						break;
					if (ch == SPECIAL1 || ch == SPECIAL2) { // 만약 특수키
															// 예를 들어 UP key의 경우 0xe0 0x48 두개의 문자가 들어온다.
						ch = getch();
						switch (ch) {
						case UP:

						case DOWN:
						case LEFT:
						case RIGHT:
							keep_moving = 1;
							break;
						default: // 방향키가 아니면 멈춘다
							keep_moving = 0;
						}
					}
					else {
						switch (ch) {
						case UP2:
						case DOWN2:
						case LEFT2:
						case RIGHT2:
							keep_moving = 1;
							break;
						default: // 방향키가 아니면 멈춘다
							keep_moving = 0;
						}
						// 특수 문자가 아니지만 AWSD를 방향키 대신 사용하는 경우 처리
					}
				}
				if (keep_moving == 1) { // 움직이고 있으면
										//
										// 벽을 만나면 방향을 변경하기 추가
										// 벽을 만날때 Delay 를 감소시키면 속도가 빨라진다.
										//			
					switch (ch) {
					case UP:
					case UP2:
						if (oldy > 0) { //벽이 아니면
										//newy = oldy - 1;

							newy = oldy - 1;
						}
						else {
							newy = oldy + 1;
							ch = DOWN;
							/*if (Delay > 10)
							Delay -= 10;*/
						}
						break;
					case DOWN:
					case DOWN2:
						if (oldy < HEIGHT - 1) {
							newy = oldy + 1;
						}
						else {
							newy = oldy - 1;
							ch = UP;
							/*if (Delay > 10)
							Delay -= 10;*/
						}
						break;
					case LEFT:
					case LEFT2:
						if (oldx > 0) {
							newx = oldx - 1;
							/*Delay += 2;*/
						}
						else {
							/*newx = oldx + 1;
							ch = RIGHT;*/
							/*if (Delay > 10)
							Delay -= 10;*/
							newx = WIDTH - 1; // 터널 효과
						}
						break;
					case RIGHT:
					case RIGHT2:
						if (oldx < WIDTH - 1) {
							newx = oldx + 1;
							/*if (Delay > 5)
							Delay -= 2;*/
						}
						else {
							/*newx = oldx - 1;
							ch = LEFT;*/
							/*if (Delay > 10)
							Delay -= 10;*/
							newx = 0; //터널효과
						}
						break;
					}

					if (room[newy][newx / 2] == 1 || room[newy][newx / 2] == 2 || room[newy][newx / 2] == 5 || room[newy][newx / 2] == 7 || room[newy][newx / 2] == 8)
					{
						newy = oldy;
						newx = oldx;
					}

					erase_character(oldx, oldy); // 마지막 위치의 * 를 지우고
					put_character(newx, newy, p2->player_shape); // 새로운 위치에서 * 를 표시한다.
					oldx = newx; // 마지막 위치를 기억한다.
					p2->x = oldx;
					oldy = newy;
					p2->y = oldy;
					keep_moving = 0; //1:계속이동, 0:한번에 한칸씩이동
					gotoxy(0, 24);
					printf("%d %d\r", newx, newy);
					gotoxy(7, 24);
					printf("열쇠 조각 : %d", key_item);

					gotoxy(22, 24);
					printf("체력 : %d", Player_HP / 2);

					gotoxy(32, 24);
					printf("이 방에서 찾은 열쇠 개수 : %d", key_item_room3);

					if ((room[newy][newx / 2] == 4))
					{
						map_state = 1;
						p1->x = 48; p1->y = 17;
						system("cls");

					}


					if ((room[newy][newx / 2] == 6))	//열쇠
					{
						key_item++;
						key_item_room4++;

						room[newy][newx / 2] = 0;
						room[newy][newx / 2 + 1] = 0;
					}

					if ((room[newy][newx / 2] == 3))	//함정 밟을시
					{
						Player_HP++;
						room[newy][newx / 2] = 0;
						room[newy][newx / 2 + 1] = 0;
						room[newy][newx / 2 - 1] = 0;
					}

					if (Player_HP == 6)		//사망
					{
						system("cls");
						playr_dead();
						break;
					}

					if ((room[newy][newx / 2] == 9))	//게임 끝 생존!
					{
						system("cls");
						player_survive();
						break;
					}
				}
			}
		}
	}
}

void main_start_screen() {
	int i, j;
	char a[30] = "Press Any Key to Start Game";
	unsigned char ch;



	gotoxy(1, 20);

	//배경 그림
	for (i = 0; i < 78; i++) {
		printf("%c", '_');
	}

	gotoxy(1, 21);

	for (i = 0; i < 78; i++) {
		printf("%c", '*');
	}

	gotoxy(1, 22);

	for (i = 0; i < 78; i++) {
		printf("%c", 'c');
	}

	gotoxy(55, 20);

	for (i = 0; i < 20; i++) {
		printf("%c", '*');
	}

	for (i = 17; i < 20; i++)
	{
		gotoxy(55, i);
		printf("%c", '*');
	}

	gotoxy(57, 15);
	printf("%c", '*');

	for (i = 16; i < 20; i++) {
		gotoxy(57, i);
		printf("%c", '|');
	}

	//
	gotoxy(5, 4);

	printf("공포의 동굴 미궁 ver.2.0.1");

	//동굴 입구 그림
	for (i = 21; i > 15; i--) {
		gotoxy(6, i);
		printf("*");
	}

	for (i = 7; i < 12; i++) {
		gotoxy(i, 15);
		printf("*");
	}

	for (i = 21; i > 15; i--) {
		gotoxy(12, i);
		printf("*");
	}

	//for (i = 9; i < 11; i++) { //가로
	//	for (j = 20; j > 15; j--) {//세로
	//		gotoxy(i, j);
	//		printf(".");
	//	}
	//}

	gotoxy(1, 17);
	printf("*");

	gotoxy(2, 16);
	printf("**");

	gotoxy(3, 16);
	printf("===");

	gotoxy(6, 15);
	printf("/");

	gotoxy(12, 15);
	printf(">");

	for (j = 16; j < 21; j++) {
		gotoxy(13, j);
		printf(">");
	}

	for (j = 17; j < 21; j++) {
		gotoxy(14, j);
		printf(">");
	}

	for (j = 18; j < 21; j++) {
		gotoxy(15, j);
		printf(">");
	}

	for (j = 19; j < 21; j++) {
		gotoxy(16, j);
		printf(">");
	}

	gotoxy(17, 20);
	printf(">");

	gotoxy(1, 17);
	printf("/");

	for (i = 2, j = 17; i < 6; i++) {
		gotoxy(i, j);
		printf("I");
	}

	for (j = 18; j < 21; j++) {
		for (i = 1; i < 6; i++) {
			gotoxy(i, j);
			printf("I");
		}
	}

	draw_box2(0, 0, 78, 22); //테두리

	gotoxy(21, 8);

	for (i = 0; i < 27; i++) {
		printf("%c", a[i]);
		Sleep(20);

	}

	ch = 0;

	while (1) {
		if (kbhit() == 1) {
			ch = getch();
			system("cls");
			break;
		}

	}

}

void game_run() {

	int i;

	unsigned char ch;

	ch = 0;

	char script1[] = "학교에서 맨날 홀로 다니던 아싸 컴붕이";

	char script2[] = "어느날 학교 뒷산에서 동굴을 발견하고";

	char script3[] = "호기심으로 그곳에 들어가게 되는데....";

	gotoxy(20, 6);

	for (i = 0; i <strlen(script1); i++) {
		printf("%c", script1[i]);
		Sleep(20);
	}

	gotoxy(20, 9);

	for (i = 0; i < strlen(script2); i += 2) {
		printf("%c%c", script2[i], script2[i + 1]);
		Sleep(20);
	}

	gotoxy(20, 12);

	for (i = 0; i < strlen(script3); i++) {
		printf("%c", script3[i]);
		Sleep(20);
	}

	while (1) {
		if (kbhit() == 1) {
			ch = getch();
			system("cls");
			break;
		}
	}
}

void game_run2() {
	int i;

	unsigned char ch;

	ch = 0;

	char script1[] = "□□□□□□□□□□□□□□□□□□□□";

	char script2[] = "□             플레이 방법            □";

	char script3[] = "□         화살표로 캐릭터 조작       □";

	char script4[] = "□     §모양의 열쇠조각 4개를 모아   □";

	char script5[] = "□          탈출에 성공하세요!!       □";

	char script6[] = "□       △모양의 함정을 밟으면       □";

	char script7[] = "□   캐릭터가 사망합니다! 목숨 3개!   □";

	char script8[] = "□□□□□□□□□□□□□□□□□□□□";

	gotoxy(20, 6);

	for (i = 0; i <strlen(script1); i++) {
		printf("%c", script1[i]);

	}

	gotoxy(20, 7);

	for (i = 0; i < strlen(script2); i += 2) {
		printf("%c%c", script2[i], script2[i + 1]);

	}

	gotoxy(20, 8);

	for (i = 0; i < strlen(script3); i++) {
		printf("%c", script3[i]);

	}

	gotoxy(20, 9);

	for (i = 0; i < strlen(script4); i++) {
		printf("%c", script4[i]);

	}

	gotoxy(20, 10);

	for (i = 0; i < strlen(script5); i++) {
		printf("%c", script5[i]);

	}

	gotoxy(20, 11);

	for (i = 0; i < strlen(script6); i++) {
		printf("%c", script6[i]);

	}

	gotoxy(20, 12);

	for (i = 0; i < strlen(script7); i++) {
		printf("%c", script7[i]);

	}

	gotoxy(20, 13);

	for (i = 0; i < strlen(script8); i++) {
		printf("%c", script8[i]);

	}

	while (1) {
		if (kbhit() == 1) {
			ch = getch();
			system("cls");
			break;
		}
	}
}

void character_move(Player *P) {
	unsigned char ch; // 특수키 0xe0 을 입력받으려면 unsigned char 로 선언해야 함
	int oldx, oldy, newx, newy;
	int keep_moving;
	textcolor(15);
	int i, j;

	newx = oldx = P->x;
	newy = oldy = P->y;

	removeCursor();

	put_character(oldx, oldy, P->player_shape);
	ch = 0; // 초기값 정지상태
	keep_moving = 0;
	while (1) {
		textcolor(15);
		if (kbhit() == 1) {  // 키보드가 눌려져 있으면
			ch = getch(); // key 값을 읽는다
						  //
						  // ESC 누르면 프로그램 종료 추가
						  //
			if (ch == ESC)
				break;
			if (ch == SPECIAL1 || ch == SPECIAL2) { // 만약 특수키
													// 예를 들어 UP key의 경우 0xe0 0x48 두개의 문자가 들어온다.
				ch = getch();
				switch (ch) {
				case UP:

				case DOWN:
				case LEFT:
				case RIGHT:
					keep_moving = 1;
					break;
				default: // 방향키가 아니면 멈춘다
					keep_moving = 0;
				}
			}
			else {
				switch (ch) {
				case UP2:
				case DOWN2:
				case LEFT2:
				case RIGHT2:
					keep_moving = 1;
					break;
				default: // 방향키가 아니면 멈춘다
					keep_moving = 0;
				}
				// 특수 문자가 아니지만 AWSD를 방향키 대신 사용하는 경우 처리
			}
		}
		if (keep_moving == 1) { // 움직이고 있으면
								//
								// 벽을 만나면 방향을 변경하기 추가
								// 벽을 만날때 Delay 를 감소시키면 속도가 빨라진다.
								//			
			switch (ch) {
			case UP:
			case UP2:
				if (oldy > 0) { //벽이 아니면
								//newy = oldy - 1;

					newy = oldy - 1;
				}
				else {
					newy = oldy + 1;
					ch = DOWN;
					/*if (Delay > 10)
					Delay -= 10;*/
				}
				break;
			case DOWN:
			case DOWN2:
				if (oldy < HEIGHT - 1) {
					newy = oldy + 1;
				}
				else {
					newy = oldy - 1;
					ch = UP;
					/*if (Delay > 10)
					Delay -= 10;*/
				}
				break;
			case LEFT:
			case LEFT2:
				if (oldx > 0) {
					newx = oldx - 1;
					/*Delay += 2;*/
				}
				else {
					/*newx = oldx + 1;
					ch = RIGHT;*/
					/*if (Delay > 10)
					Delay -= 10;*/
					newx = WIDTH - 1; // 터널 효과
				}
				break;
			case RIGHT:
			case RIGHT2:
				if (oldx < WIDTH - 1) {
					newx = oldx + 1;
					/*if (Delay > 5)
					Delay -= 2;*/
				}
				else {
					/*newx = oldx - 1;
					ch = LEFT;*/
					/*if (Delay > 10)
					Delay -= 10;*/
					newx = 0; //터널효과
				}
				break;
			}

			if (map[newy][newx / 2] == 1 || map[newy][newx / 2] == 2 || map[newy][newx / 2] == 3)
			{
				newy = oldy;
				newx = oldx;
			}

			erase_character(oldx, oldy); // 마지막 위치의 * 를 지우고
			put_character(newx, newy, P->player_shape); // 새로운 위치에서 * 를 표시한다.
			oldx = newx; // 마지막 위치를 기억한다.
			P->x = oldx;
			oldy = newy;
			P->y = oldy;
			keep_moving = 0; //1:계속이동, 0:한번에 한칸씩이동
			gotoxy(0, 24);
			printf("%d %d\r", newx, newy);
			gotoxy(7, 24);
			printf("열쇠 조각 : %d", key_item);

			////

			if (map[newy][newx / 2] == 4)
			{
				map[newy][newx / 2] = 0;
				gotoxy((newx), newy + 1);
				printf("벽이 열림");

				for (i = 0; i<HEIGHT; i++)
					for (j = 0; j < WIDTH; j++) {
						if (map[i][j] == 3)
							map[i][j] = 0;
					}

				Sleep(1000);

				gotoxy(0, 0);

				for (i = 0; i<24; i++)
				{
					for (j = 0; j<39; j++)
					{
						if (map[i][j] == 1)
						{
							textcolor(1);
							printf("□");			//벽 테두리
						}
						else if (map[i][j] == 2)	//미궁 벽
						{
							textcolor(15);
							printf("■");
						}

						else if (map[i][j] == 3) {		//열쇠를 찾으면 열리는 벽
							textcolor(8);
							printf("＠");
						}

						else if (map[i][j] == 4) {
							textcolor(6);	//벽 여는 레버
							printf("★");
						}

						else
						{
							printf("  ");			//복도, 뚫린길
						}
					}
					printf("\n");
				}
			}

			if ((newx == 17 && newy == 10) || (newx == 17 && newy == 11)) {
				map_state = 2;
				break;
			}

			if ((newx == 19 && newy == 18) || (newx == 19 && newy == 19)) {
				map_state = 3;
				break;
			}

			if ((newx == 43 && newy == 6) || (newx == 43 && newy == 7)) {
				map_state = 4;
				break;
			}

			if ((newx == 48 && newy == 16) || (newx == 49 && newy == 16) || (newx == 50 && newy == 16)) {
				map_state = 5;
				break;
			}

		}
		Sleep(Delay); // Delay를 줄이면 속도가 빨라진다.
	}
}

//맵만들기

void game_map(Player *P) {
	int i, j;

	for (i = 0; i<24; i++)
	{
		for (j = 0; j<39; j++)
		{
			if (map[i][j] == 1)
			{
				textcolor(1);
				printf("□");			//벽 테두리
			}
			else if (map[i][j] == 2)	//미궁 벽
			{
				textcolor(15);
				printf("■");
			}

			else if (map[i][j] == 3) {		//열쇠를 찾으면 열리는 벽
				textcolor(8);
				printf("＠");
			}

			else if (map[i][j] == 4) {
				textcolor(6);
				printf("★");
			}

			else
			{
				printf("  ");			//복도, 뚫린길
			}
		}
		printf("\n");
	}

	gotoxy(2, 2); //스크롤이 넘어가지않게 하기 위한 커서 위치 변경

	while (map_state == 1) {

		character_move(P);
	}
}

void playr_dead() {
	int i;

	unsigned char ch;

	ch = 0;

	char script1[] = "결국, 컴붕이는 두려움 속에서";

	char script2[] = "길을 잃고 미궁속에서 헤메다가";

	char script3[] = "함정에 그만 목숨을 잃고 말았다...";

	char script4[] = "플레이 해주셔서 감사합니다";

	gotoxy(20, 6);

	for (i = 0; i <strlen(script1); i++) {
		printf("%c", script1[i]);
		Sleep(20);
	}

	gotoxy(20, 9);

	for (i = 0; i < strlen(script2); i += 2) {
		printf("%c%c", script2[i], script2[i + 1]);
		Sleep(20);
	}

	gotoxy(20, 12);

	for (i = 0; i < strlen(script3); i++) {
		printf("%c", script3[i]);
		Sleep(20);
	}

	gotoxy(20, 17);

	for (i = 0; i < strlen(script4); i++) {
		printf("%c", script4[i]);
		Sleep(20);
	}

	gotoxy(20, 20);

	while (1) {
		if (kbhit() == 1) {
			ch = getch();
			exit(1);
		}
	}
}

void player_survive() {
	int i;

	unsigned char ch;

	ch = 0;

	char script1[] = "마침내 컴붕이는 용기를 잃지않고";

	char script2[] = "열심히 길을 찾으며";

	char script3[] = "출구를 찾아 집으로 돌아갔다.";

	char script4[] = "플레이 해주셔서 감사합니다!!";

	gotoxy(20, 6);

	for (i = 0; i <strlen(script1); i++) {
		printf("%c", script1[i]);
		Sleep(20);
	}

	gotoxy(20, 9);

	for (i = 0; i < strlen(script2); i += 2) {
		printf("%c%c", script2[i], script2[i + 1]);
		Sleep(20);
	}

	gotoxy(20, 12);

	for (i = 0; i < strlen(script3); i++) {
		printf("%c", script3[i]);
		Sleep(20);
	}

	gotoxy(20, 17);

	for (i = 0; i < strlen(script4); i++) {
		printf("%c", script4[i]);
		Sleep(20);
	}

	gotoxy(20, 20);

	while (1) {
		if (kbhit() == 1) {
			ch = getch();
			exit(1);
		}
	}
}


int main() {
	PlaySound(TEXT(Game_OST), NULL, SND_FILENAME | SND_ASYNC | SND_LOOP);
	//사운드 파일 위치, SND_ASYNC, SND_LOOP 세가지가 제일 중요
	//SND_ASYNC : 재생하면서 다음코드 실행
	//SND_LOOP : 반복재생

	Player p2;
	p2.x = 2;
	p2.y = 22;
	p2.player_shape = "옷";

	P.player_shape = "옷";	//캐릭터 모습
	P.x = 3; P.y = 3;	//캐릭터의 첫 위치

	main_start_screen();
	game_run();
	game_run2();

	map_state = 1;	//시작맵 스테이트
	Player_HP = 0;  // 플레이어 체력


	while (1) {
		if (Player_HP !=3)
		{
			if (map_state == 1) {
				game_map(&P);
			}

			else if (map_state == 2)
			{
				room1(&p2, &P);
			}

			else if (map_state == 3)
			{
				room2(&p2, &P);
			}

			else if (map_state == 4)
			{
				room3(&p2, &P);
			}

			else if (map_state == 5)
			{
				room4(&p2, &P);
			}

		}

	}


}